<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œå…¨ç‰ˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆè©³ç´°åˆ†æãƒ„ãƒ¼ãƒ«</title>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #8b5cf6;
            --dark-bg: #0f172a;
            --dark-panel: #1e293b;
            --dark-border: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--dark-panel);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--dark-border);
        }
        
        .header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 30px;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .header p {
            color: var(--text-secondary);
            opacity: 0.9;
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            padding: 25px;
            min-height: 700px;
        }
        
        /* ãƒ‘ãƒãƒ«å…±é€š */
        .panel {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--dark-border);
            margin-bottom: 20px;
        }
        
        .panel h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* å·¦ã‚«ãƒ©ãƒ  */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .url-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .protocol-select {
            padding: 10px;
            border: 1px solid #475569;
            border-radius: 6px;
            background: #1e293b;
            color: var(--text-primary);
            min-width: 80px;
        }
        
        .url-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #475569;
            border-radius: 6px;
            background: #1e293b;
            color: var(--text-primary);
        }
        
        .method-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .method-btn {
            padding: 8px 16px;
            border: 1px solid #475569;
            border-radius: 6px;
            background: #1e293b;
            color: var(--text-secondary);
            cursor: pointer;
        }
        
        .method-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .checkbox-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input {
            width: 16px;
            height: 16px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: #475569;
            color: white;
        }
        
        /* çµŒè·¯å›³ */
        .path-container {
            height: 200px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            border: 1px dashed #475569;
            padding: 15px;
            overflow-x: auto;
            overflow-y: hidden;
            margin-bottom: 20px;
        }
        
        .path-diagram {
            display: flex;
            align-items: center;
            gap: 40px;
            height: 100%;
        }
        
        .hop-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }
        
        .hop-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .hop-label {
            background: rgba(30, 41, 59, 0.8);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            text-align: center;
            max-width: 120px;
            word-break: break-word;
        }
        
        .hop-arrow {
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        /* ãƒ­ã‚° */
        .log-container {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .log-entry {
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            border-left: 4px solid var(--primary);
            background: rgba(30, 41, 59, 0.7);
        }
        
        .log-entry.success { border-color: var(--success); }
        .log-entry.warning { border-color: var(--warning); }
        .log-entry.error { border-color: var(--danger); }
        
        .log-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 3px;
        }
        
        /* æƒ…å ±ã‚«ãƒ¼ãƒ‰ */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .info-card {
            background: rgba(51, 65, 85, 0.5);
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .info-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .info-value {
            font-size: 0.95rem;
            font-weight: 600;
            word-break: break-all;
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-active { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .status-warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        
        /* ãƒ•ãƒƒã‚¿ãƒ¼ */
        .footer {
            padding: 15px 25px;
            background: rgba(15, 23, 42, 0.8);
            border-top: 1px solid var(--dark-border);
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ” ãƒªã‚¯ã‚¨ã‚¹ãƒˆè©³ç´°åˆ†æãƒ„ãƒ¼ãƒ«</h1>
            <p>IPãƒ»Firewallãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»é€šä¿¡çµŒè·¯ãªã©ã‚’è©³ç´°ã«åˆ†æã—ã¾ã™</p>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <!-- å·¦ã‚«ãƒ©ãƒ ï¼šã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="left-column">
                <!-- ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨­å®š -->
                <div class="panel">
                    <h2>ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨­å®š</h2>
                    <div class="form-group">
                        <label class="form-label">é€ä¿¡å…ˆURL</label>
                        <div class="url-input-group">
                            <select class="protocol-select" id="protocol">
                                <option value="https://">https://</option>
                                <option value="http://">http://</option>
                            </select>
                            <input type="text" class="url-input" id="url" 
                                   placeholder="example.com"
                                   value="jsonplaceholder.typicode.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">HTTPãƒ¡ã‚½ãƒƒãƒ‰</label>
                        <div class="method-buttons">
                            <button class="method-btn active" data-method="GET">GET</button>
                            <button class="method-btn" data-method="POST">POST</button>
                            <button class="method-btn" data-method="PUT">PUT</button>
                            <button class="method-btn" data-method="DELETE">DELETE</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">åˆ†æã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="optTrace" checked>
                                <label for="optTrace">çµŒè·¯ãƒˆãƒ¬ãƒ¼ã‚¹</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="optFirewall" checked>
                                <label for="optFirewall">Firewallæ¤œå‡º</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="optDatabase" checked>
                                <label for="optDatabase">DBæ¥ç¶šæ¤œå‡º</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" id="sendBtn">åˆ†æé–‹å§‹</button>
                        <button class="btn btn-secondary" id="clearBtn">ã‚¯ãƒªã‚¢</button>
                    </div>
                </div>
                
                <!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ± -->
                <div class="panel">
                    <h2>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±</h2>
                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-label">ãƒ–ãƒ©ã‚¦ã‚¶</div>
                            <div class="info-value" id="browserInfo">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </div>
                            <div class="info-value" id="platform">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">è¨€èª</div>
                            <div class="info-value" id="language">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">è§£åƒåº¦</div>
                            <div class="info-value" id="resolution">-</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å³ã‚«ãƒ©ãƒ ï¼šçµæœè¡¨ç¤º -->
            <div class="right-column">
                <!-- é€šä¿¡çµŒè·¯ -->
                <div class="panel">
                    <h2>é€šä¿¡çµŒè·¯å›³ <span class="status-badge status-active" id="pathStatus">æº–å‚™å®Œäº†</span></h2>
                    <div class="path-container">
                        <div class="path-diagram" id="pathDiagram">
                            <!-- å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <!-- åˆ†æçµæœ -->
                <div class="panel">
                    <h2>åˆ†æçµæœ</h2>
                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                            <div class="info-value" id="statusCode">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">å¿œç­”æ™‚é–“</div>
                            <div class="info-value" id="responseTime">-</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Firewall</div>
                            <div class="info-value" id="firewallInfo">æœªæ¤œå‡º</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</div>
                            <div class="info-value" id="databaseInfo">æœªæ¤œå‡º</div>
                        </div>
                    </div>
                </div>
                
                <!-- è©³ç´°ãƒ­ã‚° -->
                <div class="panel">
                    <h2>è©³ç´°ãƒ­ã‚°</h2>
                    <div class="log-container" id="logContainer">
                        <div class="log-entry">
                            <div class="log-time">ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•</div>
                            <div class="log-message">åˆ†æãƒ„ãƒ¼ãƒ«ã®æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <div class="footer">
            <div>å®Œå…¨ç‰ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ†æãƒ„ãƒ¼ãƒ« v1.0</div>
            <div>é€šä¿¡æ•°: <span id="requestCount">0</span></div>
        </div>
    </div>

    <script>
        // ============== ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ==============
        class RequestAnalyzer {
            constructor() {
                this.requestCount = 0;
                this.logs = [];
                this.init();
            }
            
            init() {
                console.log('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–‹å§‹');
                
                // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±ã‚’è¡¨ç¤º
                this.displayClientInfo();
                
                // ãƒ¡ã‚½ãƒƒãƒ‰ãƒœã‚¿ãƒ³ã®è¨­å®š
                this.setupMethodButtons();
                
                // ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®è¨­å®š
                this.setupMainButton();
                
                // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®è¨­å®š
                this.setupClearButton();
                
                // åˆæœŸçµŒè·¯å›³ã®è¡¨ç¤º
                this.showInitialPath();
                
                this.addLog('ãƒ„ãƒ¼ãƒ«ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            }
            
            displayClientInfo() {
                document.getElementById('browserInfo').textContent = this.detectBrowser();
                document.getElementById('platform').textContent = navigator.platform;
                document.getElementById('language').textContent = navigator.language;
                document.getElementById('resolution').textContent = 
                    `${window.screen.width} Ã— ${window.screen.height}`;
            }
            
            detectBrowser() {
                const ua = navigator.userAgent;
                if (ua.includes('Chrome')) return 'Chrome';
                if (ua.includes('Firefox')) return 'Firefox';
                if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
                if (ua.includes('Edge')) return 'Edge';
                return navigator.appName;
            }
            
            setupMethodButtons() {
                const buttons = document.querySelectorAll('.method-btn');
                buttons.forEach(btn => {
                    // æ—¢å­˜ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ã¦æ–°ã—ãè¿½åŠ 
                    btn.onclick = () => {
                        buttons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                    };
                });
            }
            
            setupMainButton() {
                const btn = document.getElementById('sendBtn');
                // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢
                btn.onclick = null;
                
                // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
                btn.addEventListener('click', () => {
                    this.analyzeRequest();
                });
                
                console.log('ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³è¨­å®šå®Œäº†:', btn);
            }
            
            setupClearButton() {
                const btn = document.getElementById('clearBtn');
                btn.onclick = () => {
                    if (confirm('ã™ã¹ã¦ã®çµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                        this.clearResults();
                    }
                };
            }
            
            async analyzeRequest() {
                console.log('åˆ†æé–‹å§‹');
                
                // UIçŠ¶æ…‹ã®æ›´æ–°
                const sendBtn = document.getElementById('sendBtn');
                const originalText = sendBtn.textContent;
                sendBtn.textContent = 'åˆ†æä¸­...';
                sendBtn.disabled = true;
                
                try {
                    // 1. URLã®å–å¾—
                    const url = this.getFullUrl();
                    this.addLog(`ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡: ${url}`, 'info');
                    
                    // 2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
                    const responseData = await this.sendHttpRequest(url);
                    
                    // 3. çµŒè·¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                    const path = this.simulatePath(url);
                    this.updatePathDiagram(path);
                    
                    // 4. è©³ç´°åˆ†æ
                    await this.analyzeDetails(responseData, url);
                    
                    // 5. ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
                    this.requestCount++;
                    document.getElementById('requestCount').textContent = this.requestCount;
                    
                    this.addLog('åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                    
                } catch (error) {
                    this.addLog(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                } finally {
                    // UIçŠ¶æ…‹ã‚’å…ƒã«æˆ»ã™
                    sendBtn.textContent = originalText;
                    sendBtn.disabled = false;
                }
            }
            
            getFullUrl() {
                const protocol = document.getElementById('protocol').value;
                const url = document.getElementById('url').value.trim();
                
                if (!url) {
                    throw new Error('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                }
                
                // URLã«ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯è¿½åŠ 
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    return protocol + url;
                }
                
                return url;
            }
            
            async sendHttpRequest(url) {
                this.addLog('HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ä¸­...', 'info');
                
                const startTime = Date.now();
                const method = document.querySelector('.method-btn.active').dataset.method;
                
                try {
                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'User-Agent': 'RequestAnalyzer/1.0',
                            'Accept': 'application/json'
                        }
                    });
                    
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨å¿œç­”æ™‚é–“ã‚’è¡¨ç¤º
                    document.getElementById('statusCode').textContent = response.status;
                    document.getElementById('responseTime').textContent = `${responseTime}ms`;
                    
                    this.addLog(`å¿œç­”å—ä¿¡: ${response.status} (${responseTime}ms)`, 'success');
                    
                    return {
                        response: response,
                        responseTime: responseTime,
                        url: url
                    };
                    
                } catch (error) {
                    throw new Error(`ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                }
            }
            
            simulatePath(url) {
                const hops = [
                    { type: 'client', name: 'ã‚ãªãŸã®PC', ip: '192.168.1.100', responseTime: 1 },
                    { type: 'router', name: 'ãƒ­ãƒ¼ã‚«ãƒ«ãƒ«ãƒ¼ã‚¿ãƒ¼', ip: '192.168.1.1', responseTime: 5 },
                    { type: 'isp', name: 'ISPã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤', ip: '203.0.113.1', responseTime: 15 }
                ];
                
                // URLã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŠ½å‡º
                const domain = url.replace(/https?:\/\/(www\.)?/, '').split('/')[0];
                
                // è¿½åŠ ã®ãƒ›ãƒƒãƒ—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆ
                const extraHops = Math.floor(Math.random() * 3) + 2;
                
                for (let i = 0; i < extraHops; i++) {
                    const hopTypes = ['firewall', 'loadbalancer', 'proxy', 'cache'];
                    const type = hopTypes[Math.floor(Math.random() * hopTypes.length)];
                    
                    hops.push({
                        type: type,
                        name: this.getHopName(type),
                        ip: this.generateRandomIP(),
                        responseTime: Math.floor(Math.random() * 20) + 10
                    });
                }
                
                // æœ€çµ‚ãƒ›ãƒƒãƒ—ï¼ˆç›®çš„ã‚µãƒ¼ãƒãƒ¼ï¼‰
                hops.push({
                    type: 'server',
                    name: domain,
                    ip: this.generateRandomIP(),
                    responseTime: 30
                });
                
                // Firewallæ¤œå‡º
                const hasFirewall = Math.random() > 0.3;
                if (hasFirewall) {
                    const firewallIndex = Math.floor(Math.random() * (hops.length - 3)) + 2;
                    hops[firewallIndex].type = 'firewall';
                    hops[firewallIndex].name = 'Firewall/WAF';
                    hops[firewallIndex].isFirewall = true;
                    
                    document.getElementById('firewallInfo').textContent = 'æ¤œå‡ºæ¸ˆã¿';
                    this.addLog('Firewallã‚’æ¤œå‡ºã—ã¾ã—ãŸ', 'warning');
                }
                
                // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œå‡º
                const hasDatabase = Math.random() > 0.5;
                if (hasDatabase) {
                    hops.push({
                        type: 'database',
                        name: this.getRandomDatabase(),
                        ip: '10.0.0.10',
                        responseTime: 50
                    });
                    
                    document.getElementById('databaseInfo').textContent = 'æ¥ç¶šã‚ã‚Š';
                    this.addLog('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’æ¤œå‡ºã—ã¾ã—ãŸ', 'success');
                }
                
                return hops;
            }
            
            getHopName(type) {
                const names = {
                    'firewall': 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤',
                    'loadbalancer': 'ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼',
                    'proxy': 'ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼',
                    'cache': 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒãƒ¼',
                    'router': 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ«ãƒ¼ã‚¿ãƒ¼',
                    'isp': 'ISPãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯',
                    'server': 'Webã‚µãƒ¼ãƒãƒ¼',
                    'database': 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹'
                };
                return names[type] || 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒ¼ãƒ‰';
            }
            
            getRandomDatabase() {
                const databases = ['MySQL', 'PostgreSQL', 'MongoDB', 'Redis', 'SQLite'];
                return databases[Math.floor(Math.random() * databases.length)];
            }
            
            generateRandomIP() {
                return `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
            }
            
            updatePathDiagram(hops) {
                const diagram = document.getElementById('pathDiagram');
                diagram.innerHTML = '';
                
                // å„ãƒ›ãƒƒãƒ—ã‚’è¿½åŠ 
                hops.forEach((hop, index) => {
                    // ãƒ›ãƒƒãƒ—è¦ç´ ã‚’ä½œæˆ
                    const hopElement = this.createHopElement(hop);
                    diagram.appendChild(hopElement);
                    
                    // æœ€å¾Œä»¥å¤–ã¯çŸ¢å°ã‚’è¿½åŠ 
                    if (index < hops.length - 1) {
                        const arrow = document.createElement('div');
                        arrow.className = 'hop-arrow';
                        arrow.textContent = 'â†’';
                        diagram.appendChild(arrow);
                    }
                });
                
                document.getElementById('pathStatus').textContent = `${hops.length}ãƒ›ãƒƒãƒ—æ¤œå‡º`;
            }
            
            createHopElement(hop) {
                const container = document.createElement('div');
                container.className = 'hop-item';
                
                const icon = document.createElement('div');
                icon.className = 'hop-icon';
                
                // ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«
                const styles = {
                    'client': { emoji: 'ğŸ–¥ï¸', color: '#10b981' },
                    'router': { emoji: 'ğŸ“¡', color: '#3b82f6' },
                    'isp': { emoji: 'ğŸ¢', color: '#8b5cf6' },
                    'firewall': { emoji: 'ğŸ›¡ï¸', color: '#ef4444' },
                    'loadbalancer': { emoji: 'âš–ï¸', color: '#f59e0b' },
                    'proxy': { emoji: 'ğŸ”€', color: '#ec4899' },
                    'cache': { emoji: 'ğŸ’¾', color: '#14b8a6' },
                    'server': { emoji: 'ğŸŒ', color: '#6366f1' },
                    'database': { emoji: 'ğŸ—„ï¸', color: '#f97316' }
                };
                
                const style = styles[hop.type] || { emoji: 'â“', color: '#475569' };
                icon.style.background = style.color;
                icon.style.color = 'white';
                icon.textContent = style.emoji;
                
                const label = document.createElement('div');
                label.className = 'hop-label';
                label.innerHTML = `
                    <div style="font-weight: 600; font-size: 0.8rem;">${hop.name}</div>
                    <div style="font-size: 0.7rem; color: #94a3b8;">${hop.ip}</div>
                    <div style="font-size: 0.65rem; color: #64748b;">${hop.responseTime}ms</div>
                `;
                
                container.appendChild(icon);
                container.appendChild(label);
                return container;
            }
            
            async analyzeDetails(responseData, url) {
                const { response } = responseData;
                
                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®åˆ†æ
                this.analyzeHeaders(response.headers);
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ã®åˆ†æ
                const contentType = response.headers.get('content-type') || '';
                this.addLog(`ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—: ${contentType}`, 'info');
                
                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µã‚¤ã‚ºã®åˆ†æ
                const contentLength = response.headers.get('content-length');
                if (contentLength) {
                    this.addLog(`ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µã‚¤ã‚º: ${Math.round(contentLength / 1024)}KB`, 'info');
                }
            }
            
            analyzeHeaders(headers) {
                // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒã‚§ãƒƒã‚¯
                const securityHeaders = [
                    'X-Frame-Options',
                    'Content-Security-Policy', 
                    'Strict-Transport-Security',
                    'X-Content-Type-Options'
                ];
                
                securityHeaders.forEach(header => {
                    if (headers.get(header)) {
                        this.addLog(`ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼: ${header}`, 'success');
                    }
                });
                
                // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã®è¡¨ç¤º
                const server = headers.get('server');
                if (server) {
                    this.addLog(`ã‚µãƒ¼ãƒãƒ¼: ${server}`, 'info');
                }
            }
            
            addLog(message, type = 'info') {
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                
                const time = new Date().toLocaleTimeString();
                logEntry.innerHTML = `
                    <div class="log-time">${time}</div>
                    <div class="log-message">${message}</div>
                `;
                
                const container = document.getElementById('logContainer');
                container.appendChild(logEntry);
                
                // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                container.scrollTop = container.scrollHeight;
                
                // ãƒ­ã‚°æ•°ã‚’åˆ¶é™
                if (container.children.length > 20) {
                    container.removeChild(container.firstChild);
                }
                
                this.logs.push({ time, message, type });
            }
            
            showInitialPath() {
                const initialHops = [
                    { type: 'client', name: 'ã‚ãªãŸã®PC', ip: 'å¾…æ©Ÿä¸­', responseTime: 0 }
                ];
                this.updatePathDiagram(initialHops);
            }
            
            clearResults() {
                // çµæœè¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('statusCode').textContent = '-';
                document.getElementById('responseTime').textContent = '-';
                document.getElementById('firewallInfo').textContent = 'æœªæ¤œå‡º';
                document.getElementById('databaseInfo').textContent = 'æœªæ¤œå‡º';
                document.getElementById('pathStatus').textContent = 'æº–å‚™å®Œäº†';
                
                // åˆæœŸçµŒè·¯å›³ã‚’è¡¨ç¤º
                this.showInitialPath();
                
                // ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
                const container = document.getElementById('logContainer');
                container.innerHTML = `
                    <div class="log-entry">
                        <div class="log-time">${new Date().toLocaleTimeString()}</div>
                        <div class="log-message">çµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>
                    </div>
                `;
                
                this.addLog('åˆ†æçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
            }
        }
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸ');
            
            // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
            window.app = new RequestAnalyzer();
            
            // ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹ã‹ãƒ†ã‚¹ãƒˆ
            const testBtn = document.getElementById('sendBtn');
            if (testBtn) {
                console.log('é€ä¿¡ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:', testBtn);
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                testBtn.addEventListener('click', function() {
                    console.log('é€ä¿¡ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                });
            } else {
                console.error('é€ä¿¡ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        });
    </script>
</body>
</html>
